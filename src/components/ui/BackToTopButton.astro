---
import { Button } from "@/components/starwind/button";
import { Icon } from "astro-icon/components";
---

<Button
  id="back-to-top"
  class="invisible fixed right-5 bottom-5 cursor-pointer rounded-full p-2 opacity-0 shadow-lg"
  aria-label="Back to top"
>
  <Icon name="round-arrow-up-bold-duotone" class="size-8" />
</Button>

<script>
  function backToTop() {
    const backToTopButton = document.getElementById("back-to-top");

    function toggleBackToTopButton() {
      if (!backToTopButton) return;
      if (window.scrollY > 200) {
        backToTopButton.classList.remove("opacity-0", "invisible");
        backToTopButton.classList.add("opacity-100", "visible");
      } else {
        backToTopButton.classList.add("opacity-0", "invisible");
        backToTopButton.classList.remove("opacity-100", "visible");
      }
    }

    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: "smooth",
      });
    }

    window.addEventListener("scroll", toggleBackToTopButton);
    if (backToTopButton) {
      backToTopButton.addEventListener("click", scrollToTop);
    }
    // Initial state
    toggleBackToTopButton();
  }

  // Run on initial load
  backToTop();

  // Re-run after every Astro view transition
  document.addEventListener("astro:after-swap", backToTop);
</script>
