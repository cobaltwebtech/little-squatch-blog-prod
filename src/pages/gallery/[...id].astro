---
import BaseLayout from '@/layouts/BaseLayout'
import Lightbox from '@julian_cataldo/astro-lightbox/Lightbox.astro'
import ArrowLeft from './src/components/icons/ArrowLeft.astro'
import { Image } from 'astro:assets'
import { getCollection } from 'astro:content'
import { getAlbumImages } from './src/utils/albums.ts'

export async function getStaticPaths() {
  const albums = await getCollection("albums");

  const paths = Object.values(albums).map((album) => {
    return {
      params: {
        id: album.id,
      },
      props: {
        album,
      },
    };
  });

  return paths;
}

const { album } = Astro.props;
const images = await getAlbumImages(album.id);
---

<BaseLayout title={album.data.title}>
    <section class="text-center">
      <h2 class="text-5xl font-bold">
        {album.data.title}
      </h2>
      <p class="text-xl my-4">
        {album.data.description}
      </p>

      <div
        class="mx-auto container my-8 sm:columns-2 md:columns-3 lg:columns-4 xl:columns-5 text-center"
      >
        {
          images.map((image) => (
            <div data-lightbox="true">
              <Image
                src={image}
                alt={`Image from ${album.data.title} album`}
                format="avif"
                quality={50}
                class="rounded mb-4 border border-transparent hover:border-gray-300 transition-all duration-300 ease-in-out hover:shadow-lg"
                loading="lazy"
                data-album-image
              />
            </div>
          ))
        }
      </div>

			<div
				class='flex flex-col md:flex-row'
			>
				<a href='/gallery' class='flex items-center gap-1 text-l sm:text-xl sm:w-max md:text-base'>
					<ArrowLeft /> Back to Gallery
        </a>
			</div>			
    </section>
</BaseLayout>

<Lightbox />
